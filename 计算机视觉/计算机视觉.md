# 计算机视觉

[TOC]

## 课程内容

- 教材：《Computer Vision: Algorithms and Applications》
  - http://szeliski.org/Book
- 《Computer Vision: A Modern Approach》
- 《Computer Vision: Models, Learning, and Inference》
- 《Learning OpenCV》

### 考核与成绩

![image-20221108105137710](计算机视觉.assets/image-20221108105137710.png)

### 编程作业的提交

![image-20221108105345790](计算机视觉.assets/image-20221108105345790.png)

### 考试

全是大题12题到13题，分成以下种类：

- 描述算法，需要背
- 推导公式
- 计算题

## OpenCV Tutorial

### 图像

类型：

- 二值
- 灰度gray scale，用一个byte来表示，256
- 彩色

![image-20221108111333708](计算机视觉.assets/image-20221108111333708.png)

## Edge Detection 边缘检测

### 边缘及边缘检测概念

目标：identify sudden changes (discontinuities) in an image

边缘的原因：

- surface normal discontinuity
- depth discontinuity
- surface color discontinuity
- illumination discontinuity

边缘的特点：

- intensity灰度变化很大。求导计算极值，或者求二阶导得零点

  ![image-20221123140317275](计算机视觉.assets/image-20221123140317275.png)

### 用模板实现卷积

![image-20221123140717553](计算机视觉.assets/image-20221123140717553.png)

![image-20221123140730207](计算机视觉.assets/image-20221123140730207.png)

### 基于一阶导数的边缘检测

![image-20221123142014285](计算机视觉.assets/image-20221123142014285.png)

![image-20221123142100351](计算机视觉.assets/image-20221123142100351.png)

上面最下面两种方式是近似幅值的公式

![image-20221123141240736](计算机视觉.assets/image-20221123141240736.png)

![image-20221123141341957](计算机视觉.assets/image-20221123141341957.png)

2*2算子不对称

![image-20221123141349919](计算机视觉.assets/image-20221123141349919.png)

### 基于二阶导数的边缘检测

#### Laplacian算子

![image-20221123143603613](计算机视觉.assets/image-20221123143603613.png)

![image-20221123143740745](计算机视觉.assets/image-20221123143740745.png)

#### LoG算子（Marr&Hildreth算子）

![image-20221123143901965](计算机视觉.assets/image-20221123143901965.png)

![image-20221123144001142](计算机视觉.assets/image-20221123144001142.png)

优化：$g$是高斯函数，可以先做$\nabla^2g$，然后就可以对任意一张图片$f$来处理了。

![image-20221123144143131](计算机视觉.assets/image-20221123144143131.png)

### Canny边缘检测

![image-20221123144459239](计算机视觉.assets/image-20221123144459239.png)

思想：

- 如果有不太显著的边缘，就看周围有没有强的边缘（双阈值）
- 一阶导数会让线比较粗，于是就找边缘的”山脊“，看某个像素的梯度在自己方向上是否是最大的（非极大值抑制NMS）

![image-20221123145128168](计算机视觉.assets/image-20221123145128168.png)

![image-20221123145149540](计算机视觉.assets/image-20221123145149540.png)

![image-20221123145357915](计算机视觉.assets/image-20221123145357915.png)

高斯函数的$\sigma$表示周围像素对当前像素的影响，$\sigma$越大就越模糊，边缘就越来越小

## Curves 曲线

### 曲线表示

![image-20221123151310019](计算机视觉.assets/image-20221123151310019.png)

### 曲线拟合

![image-20221123151712910](计算机视觉.assets/image-20221123151712910.png)

![image-20221123152118426](计算机视觉.assets/image-20221123152118426.png)

![image-20221123152134028](计算机视觉.assets/image-20221123152134028.png)

![image-20221123152150254](计算机视觉.assets/image-20221123152150254.png)

#### 直线

![image-20221123152209002](计算机视觉.assets/image-20221123152209002.png)

![image-20221123152343504](计算机视觉.assets/image-20221123152343504.png)

#### 分线段/多边形

![image-20221123152556859](计算机视觉.assets/image-20221123152556859.png)

![image-20221123152733498](计算机视觉.assets/image-20221123152733498.png)

#### 椭圆

![image-20221123152826523](计算机视觉.assets/image-20221123152826523.png)

### Hough变换

#### 直线检测

![image-20221123153657580](计算机视觉.assets/image-20221123153657580.png)

对于经过某个坐标$(x,y)$的直线可以在cm坐标系中也找到一根直线，直线上的某一点$(c,m)$可以确定一根直线，所以在cm坐标系中各条直线的交点$(c,m)$就得到一条共同直线

[【图像处理算法】Hough变换](https://blog.csdn.net/qq_15971883/article/details/80583364)

经过一个点的直线在极坐标系下是一根正弦函数，因此多条正弦函数的交点就是共同的直线

![image-20221123192844002](计算机视觉.assets/image-20221123192844002.png)

![image-20221123192937220](计算机视觉.assets/image-20221123192937220.png)

![image-20221123193044206](计算机视觉.assets/image-20221123193044206.png)

#### 圆形检测

![image-20221123194342005](计算机视觉.assets/image-20221123194342005.png)

![image-20221123194351069](计算机视觉.assets/image-20221123194351069.png)

## Image Local Features

### Feature Detection

- Harris corner detector

  ![image-20221123195750362](计算机视觉.assets/image-20221123195750362.png)

  思想：用一个小窗口圈住一个部分，然后移动，如果变化大就说明是特征点。所以就让两个矩阵相减即可。

- ![image-20221123221248648](计算机视觉.assets/image-20221123221248648.png)

  相减的时候还要用一个窗口函数$w$

  此处$(u,v)$表示的是窗口移动的方向

  ![image-20221123235317168](计算机视觉.assets/image-20221123235317168.png)

  ![image-20221124000628019](计算机视觉.assets/image-20221124000628019.png)

  可视化之后$E(u,v)$相当于一个三维曲面

  ![image-20221124001246431](计算机视觉.assets/image-20221124001246431.png)

  让$E(u,v)$等于一个固定常数，然后可以得到圆或者椭圆。这个椭圆上面的点表示：移动到两个不同的位置$E(u,v)$相同，那么在这两个位置越近说明变化越快，越远表示变化越慢

  ![image-20221124001446738](计算机视觉.assets/image-20221124001446738.png)

  椭圆的长短轴是看特征值的，长度表示$E(u,v)$变化的快慢

  ![image-20221124001532225](计算机视觉.assets/image-20221124001532225.png)

  定义Corner，$\lambda$都要大，且近似相等

  ![image-20221124002015202](计算机视觉.assets/image-20221124002015202.png)

  人为规定下面的公式来判别Corner：

  ![image-20221124002103687](计算机视觉.assets/image-20221124002103687.png)

  ![image-20221124002218541](计算机视觉.assets/image-20221124002218541.png)

  ![image-20221124002801440](计算机视觉.assets/image-20221124002801440.png)

### Feature Descriptions

Harris Corner对旋转、反射亮度影响很小，但是缩放影响很大

思路是：对某个点周围的窗口size建立函数，当图片放大的时候这个函数也会相应变化，目标是找到最适合观测的一个窗口（极值）

![image-20221203201943317](计算机视觉.assets/image-20221203201943317.png)

我们要在xy空间之外增加一个scale的空间

![image-20221203202136216](计算机视觉.assets/image-20221203202136216.png)

![image-20221203202236772](计算机视觉.assets/image-20221203202236772.png)

![image-20221203202917973](计算机视觉.assets/image-20221203202917973.png)

![image-20221203203030838](计算机视觉.assets/image-20221203203030838.png)

## Image Stitching

SIFT找一个16\*16的窗口，先要在一个优化的scale空间里找，然后再求128位向量

![image-20221203235010050](计算机视觉.assets/image-20221203235010050.png)

三个点对可以计算出六个参数

![image-20221204000246961](计算机视觉.assets/image-20221204000246961.png)

![image-20221204000302707](计算机视觉.assets/image-20221204000302707.png)

![image-20221204000500806](计算机视觉.assets/image-20221204000500806.png)

### Image Blending

在拼接的区域可以按权重过渡

![image-20221204001701682](计算机视觉.assets/image-20221204001701682.png)

## 图像空间变换

特征脸：

协方差描述两个随机变量之间的关系。如果协方差大于0，一个增大另一个也偏向于增大；如果小于0，一个增大另一个会减小；如果是0就表示不相关

独立肯定不相关，不相关不一定独立

主元分析PCA：

找个一个方向投影之后分散，方差很大

![image-20221205004828562](计算机视觉.assets/image-20221205004828562.png)

![image-20221205004923926](计算机视觉.assets/image-20221205004923926.png)

![image-20221205005026356](计算机视觉.assets/image-20221205005026356.png)

![image-20221205005057717](计算机视觉.assets/image-20221205005057717.png)

我们要求的是$a_1$，这是投影的方向，最后我们发现就是协方差矩阵的特征向量，算出来之后可以带进去求$var(z_1)$，我们最后发现要找特征值最大对应的特征向量

![image-20221205005438583](计算机视觉.assets/image-20221205005438583.png)

我们目前找到了一个方向，对于高维向量我们还想找到其他方向：方法就是和已经得到的方向正交，同时也能让在它的方向上投影方差最大

![image-20221205005611694](计算机视觉.assets/image-20221205005611694.png)

![image-20221205005700735](计算机视觉.assets/image-20221205005700735.png)

![image-20221205005716131](计算机视觉.assets/image-20221205005716131.png)

最后我们得到多个方向拼在一起，然后做投影

![image-20221205005850177](计算机视觉.assets/image-20221205005850177.png)

某个随机向量接近于高斯分布就比较适合PCA

## Visual Recognition

- K-nearest neighbor alogrithm

  ![image-20221228202147870](计算机视觉.assets/image-20221228202147870.png)

  ![image-20221228203331093](计算机视觉.assets/image-20221228203331093.png)

  当维度增大，会出现维度灾难，某个点和其他点的距离比值趋近于1（欧式距离），即分辨率降低。所以在高维上使用欧氏距离有问题，而是cos距离（理解为夹角）

## Object Categorization

- Bag-of-words model

  ![image-20221229142934213](计算机视觉.assets/image-20221229142934213.png)

  重点在如何将图片切分成多个code word

  这些code word和线性空间的基的区别在于这些word是可以冗余的

  ![image-20221229143709885](计算机视觉.assets/image-20221229143709885.png)

  可以用regular grid去切分，也可以用特征点切出一部分

  具体是先计算SIFT特征点，然后聚类，然后切出对应部分图片

  ![image-20221229143841085](计算机视觉.assets/image-20221229143841085.png)

  ![image-20221229143853082](计算机视觉.assets/image-20221229143853082.png)

  ![image-20221229143905944](计算机视觉.assets/image-20221229143905944.png)

## Convolution

![image-20221229150053618](计算机视觉.assets/image-20221229150053618.png)

欠拟合：bias

过拟合：variance

## BP

![image-20221229154607853](计算机视觉.assets/image-20221229154607853.png)

计算方法：首先已知$x/y/z$，然后正向计算每个节点上的值$q/f$，然后对每个节点反向各个路径求偏导，例如求$f$对$z/q$的偏导、求$q$对$x/y$的偏导，之后开始传播，传播的时候要乘上前面已经计算出来的值就可以了。

![image-20221229221138157](计算机视觉.assets/image-20221229221138157.png)

## Motion Estimation

Optical Flow：光流，找两幅图片亮度有明显变化

![image-20221229225501845](计算机视觉.assets/image-20221229225501845.png)

使用三个假设

![image-20221229225759388](计算机视觉.assets/image-20221229225759388.png)

![image-20221229230007315](计算机视觉.assets/image-20221229230007315.png)

![image-20221230110715145](计算机视觉.assets/image-20221230110715145.png)

![image-20221230110815048](计算机视觉.assets/image-20221230110815048.png)

最后只能得到一条等式，但其中有两个变量，实际上人也经常会有视觉illusion，原因也是在于一条等式不能比较好地确定运动方向。

因此我们这里假设两个点距离足够近，使得$u=v$

![image-20221230113116283](计算机视觉.assets/image-20221230113116283.png)

## Camera

投影之后长度丢失，共线保持

加透镜之后光更强

![image-20221230115853331](计算机视觉.assets/image-20221230115853331.png)

大光圈，小景深；小光圈，大景深

![image-20221230120220665](计算机视觉.assets/image-20221230120220665.png)

焦距越大，field of view就越小，看的更加远

![image-20221230150121645](计算机视觉.assets/image-20221230150121645.png)

投影：

![image-20221230151339540](计算机视觉.assets/image-20221230151339540.png)

四种坐标：

- 相机坐标
- 世界坐标
- 成像面坐标
- 图像坐标

前三种都是厘米为单位，最后一个是像素为单位

![image-20221230162818860](计算机视觉.assets/image-20221230162818860.png)

引入齐次坐标

![image-20221230163045090](计算机视觉.assets/image-20221230163045090.png)

![image-20221230163152862](计算机视觉.assets/image-20221230163152862.png)

![image-20221230163355021](计算机视觉.assets/image-20221230163355021.png)

投影矩阵

![image-20221230163458286](计算机视觉.assets/image-20221230163458286.png)

总结：相机坐标映射到成像面

![image-20221230164418906](计算机视觉.assets/image-20221230164418906.png)

成像面坐标到图像坐标

![image-20221230164504677](计算机视觉.assets/image-20221230164504677.png)

两个变换矩阵乘起来

![image-20221230164817047](计算机视觉.assets/image-20221230164817047.png)

![image-20221230165458333](计算机视觉.assets/image-20221230165458333.png)

以上称为相机内参

世界坐标到相机坐标

![image-20221230165450376](计算机视觉.assets/image-20221230165450376.png)

以上是相机外参

## Camera Calibration

失真类型：

- Radial distortion

  原因：透镜的物理性质不均匀、光圈的位置

  ![image-20221230170132176](计算机视觉.assets/image-20221230170132176.png)

  ![image-20221230170249754](计算机视觉.assets/image-20221230170249754.png)

- Tangential distortion

  原因：光轴没有完全垂直

  ![image-20221230170737672](计算机视觉.assets/image-20221230170737672.png)

定标的方法：

用一个calibration object，拍照之后，得到多对对应点，以此可以求出参数

![image-20221230172004278](计算机视觉.assets/image-20221230172004278.png)

![image-20221230172049332](计算机视觉.assets/image-20221230172049332.png)

![image-20221230172100974](计算机视觉.assets/image-20221230172100974.png)

## Stereo Vision

![image-20221230172753628](计算机视觉.assets/image-20221230172753628.png)

![image-20221230173324336](计算机视觉.assets/image-20221230173324336.png)
