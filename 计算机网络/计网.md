# 计网

[TOC]

## 第一章 引言

### 评分规则

- 平时成绩 50%
  - 课程作业7-8次
  - 课程实验6次
  - (optional) 分组presentation
  - 出勤+quiz 3-4次
- 期末考试 50%

### 网络实例

- 网络分类
  - 个域网PAN
  - 局域网LAN
  - 城域网MAN
  - 广域网WAN：Wide Area Network
- 网络的网络
  - ![image-20221001204743248](计网.assets/image-20221001204743248.png)
- 网络构成
  - 网络边缘
    - 主机
    - 接入网，边缘路由器。如光纤FTTH、数字用户线DSL、同轴电缆、无线连接、企业和家庭网络
    - 物理介质
      - 引导型介质
        - 光纤
        - 双绞线
      - 非引导型介质
        - 无线电
        - 蓝牙
        - 卫星
  - 网络核心
    - 交换模型
      - 分组交换
      - 电路交换：先建立物理连接，资源利用率低。使用FDM和TDM，无法应对互联网中突发Burst流量
      - ![image-20221001210959879](计网.assets/image-20221001210959879.png)
    - 两大功能：路由和转发

### 协议与分层结构

横向是协议，纵向是服务（提供接口）

服务类型：

- 面向连接
- 无连接

### 参考模型

![image-20221001212021659](计网.assets/image-20221001212021659.png)

IP地址和MAC地址不同因为分层

![image-20221001212304763](计网.assets/image-20221001212304763.png)

无连接与面向连接：

- OSI模型网络层能支持无连接和面向连接
- TCP/IP模型的网络层仅支持无连接通信（IP）

![image-20221001212918261](计网.assets/image-20221001212918261.png)

### 计算机网络度量单位

- 比特率 bps

- 带宽：网络中某通道单位时间内能通过的最高数据率 bit/s

- 包转发率PPS：交换机或路由器以包为单位的转发速率

  - 线速转发：交换机在满负载情况下帧转发达到最高速度
  - 大包更容易实现线速，因为大包数量少，控制计算比较少

- 时延

  ![image-20221001213310350](计网.assets/image-20221001213310350.png)

  ![image-20221001213404411](计网.assets/image-20221001213404411.png)

- RTT（Round-Trip Time）：来回时间

- 时延带宽积：**传播**时延*带宽

  ![image-20221001213634829](计网.assets/image-20221001213634829.png)

- 吞吐量 throughput

  - 单位时间内通过某个网络或信道的数据量，单位是b/s

- 有效吞吐量

- 利用率

- 丢包率

- 时延抖动：变化的时延

- 延迟丢包

## 第二章 物理层

### 物理层基本概念

- 物理层接口特性

  ![image-20221001232919198](计网.assets/image-20221001232919198.png)

- 物理层常用标准

  - 点对点通信线路

  - 广播通信线路

    ![image-20221001233248952](计网.assets/image-20221001233248952.png)

### 数据通信基础

- 数据通信基础理论

  ![image-20221001233409957](计网.assets/image-20221001233409957.png)

  ![image-20221001233509551](计网.assets/image-20221001233509551.png)

  ![image-20221001233952361](计网.assets/image-20221001233952361.png)

  当谐波数量比较多的时候才能恢复出原来的信号

  ![image-20221001234027864](计网.assets/image-20221001234027864.png)

  ![image-20221001234235602](计网.assets/image-20221001234235602.png)

  我的理解：信号用傅里叶分析转化成多条谐波（即sin/cos中的某一项）的叠加，当谐波数越多就越接近真正的信号，但是线路有截止频率（频宽有限），使得超过某个频率就不能传输。所以带宽和传播速度有关。

  ![image-20221001234955267](计网.assets/image-20221001234955267.png)

  注意当V=2的时候，最大传输率就是2H。上上图中的例子，一个symbol是8位（一个周期能表示8bit，所以需要256 level），所以V=$2^8$

  ![image-20221001235048592](计网.assets/image-20221001235048592.png)

  symbol rate表示每秒中有多少个波形，每个波形能代表多少位（如果level是8就能代表3bit）

  ![image-20221001235745270](计网.assets/image-20221001235745270.png)

  **重要**：实际做题的时候，应该计算有信噪和无信噪两种情况并取小的那个作为上界

  ![image-20221002000155388](计网.assets/image-20221002000155388.png)

  事件出现概率小就信息量大

- 基本概念与术语

- 传输方式

  - ![image-20221002001350952](计网.assets/image-20221002001350952.png)
  - ![image-20221002001257081](计网.assets/image-20221002001257081.png)
  - ![image-20221002001400925](计网.assets/image-20221002001400925.png)

- 数据编码技术

  - ![image-20221002001535336](计网.assets/image-20221002001535336.png)

  - ![image-20221002001641881](计网.assets/image-20221002001641881.png)

    曼彻斯特编码缺点：时钟要求变高，2倍

  - ![image-20221002001736387](计网.assets/image-20221002001736387.png)

- 频带传输：数字数据的模拟传播，也称载波传输

  - ![image-20221002001953967](计网.assets/image-20221002001953967.png)

  - ![image-20221002002150492](计网.assets/image-20221002002150492.png)

    收音机AM调幅，FM调频

    ![image-20221002002335277](计网.assets/image-20221002002335277.png)

    上面点的数量就是V的值。最后一张图，有些点角度不同表示相位不同，到原点距离不同表示幅度不同

### 传输介质

- 非导引

  - ![image-20221002004836994](计网.assets/image-20221002004836994.png)

  - ![image-20221002004945940](计网.assets/image-20221002004945940.png)

    ![image-20221002111410319](计网.assets/image-20221002111410319.png)

    短波会出现干扰

  - 散射传播

  - 地面微波

  - 光波传输

    - 频率低的时候饶射能力强，光的频率高饶射能力低，带宽高

  - 可见光传输

- 导引

  - 双绞线

  - 磁介质：磁带交通运输，带宽非常大，但是延迟很大

    ![image-20221002003630503](计网.assets/image-20221002003630503.png)

  - 同轴电缆

  - 光纤

    ![image-20221002004054242](计网.assets/image-20221002004054242.png)

    多模表示光纤内有多种光纤

    ![image-20221002004222304](计网.assets/image-20221002004222304.png)

  - 电力载波

### 无线与卫星通信

卫星通信特点：

- 传播时延长，达到500-800ms
- 损耗大，200dB

类型：

- 同步卫星通信
- 低轨道卫星系统 LEO
  - 带宽小

### 多路复用技术

- FDM

  ![image-20221002113817541](计网.assets/image-20221002113817541.png)

- TDM

  ![image-20221002113848587](计网.assets/image-20221002113848587.png)

  缺点：

  - 延迟
  - 带宽浪费

- STDM 统计时分复用

  ![image-20221002114133524](计网.assets/image-20221002114133524.png)

- WDM 波分复用

  多束不同波长激光

- CDMA 码分复用

  ![image-20221002114236230](计网.assets/image-20221002114236230.png)

  ![image-20221002114413637](计网.assets/image-20221002114413637-16646822540491.png)

  ![image-20221002135727729](计网.assets/image-20221002135727729.png)

  ![image-20221002140800356](计网.assets/image-20221002140800356.png)

  抗干扰，更加安全

- OFDM 正交频分复用

  ![image-20221002140840819](计网.assets/image-20221002140840819.png)

  将一个信道再分成多个正交子信道

  ![image-20221002141135509](计网.assets/image-20221002141135509.png)

  利用欧拉公式变换

  ![image-20221002141218973](计网.assets/image-20221002141218973.png)

  $c_n$变换成$F(\omega)$，将$L$趋向于无穷大，将傅里叶级数变成了**傅里叶变换**

  ![image-20221002141356261](计网.assets/image-20221002141356261.png)

  离散的傅里叶变换

  ![image-20221002141450924](计网.assets/image-20221002141450924.png)

  下面是FDM的问题：大的带宽导致短的symbol time。由于多路传播（例如多次反射）导致不同光到的频率不同，从而出现延迟，而symbol time很短，就会导致出现严重的ISI（干扰）

  ![image-20221002141847507](计网.assets/image-20221002141847507.png)

  OFDM将宽频划分成窄频

  ![image-20221002141911681](计网.assets/image-20221002141911681.png)

  ![image-20221002141936148](计网.assets/image-20221002141936148.png)

  ![image-20221002142014847](计网.assets/image-20221002142014847.png)

  将一条信道分成多份，然后调制到不同频率上去，但是这实施起来非常困难

  ![image-20221002142412010](计网.assets/image-20221002142412010.png)

  后来发现这个公式和离散傅里叶逆变换一样，所以不需要分成多份依次调制，只需要对整个信号做一次IDFT就在逻辑上给信号分层了

  ![image-20221002142534647](计网.assets/image-20221002142534647.png)

## 第三章 数据链路层基础

### 数据链路层的设计问题

- 位置

  - ![image-20221002142830289](计网.assets/image-20221002142830289.png)

- 功能

  - 成帧
  - 差错控制
  - 流量控制

- 提供服务

  - 无确认无连接服务
    - 以太网
  - 有确认无连接服务
    - 802.11
  - 有确认有连接服务

- 成帧

  - 字节计数法：每个frame的第一个字节表示该frame有多少字节

    - 问题：出错就破坏了帧的边界

  - 带字节填充的定界符法

    - 定界符（FLAG）：一个特殊字节用于区分前后两个不同的帧，如01111110, 0x7E

    - 当有效载荷中出现定界符加上转义字符

      ![image-20221002143436902](计网.assets/image-20221002143436902.png)

    - 问题：代价比较大

  - 带比特填充的定界符

    - 定界符：01111110, 0x7E

    - 如果有效载荷中出现5个连续的1就直接插入1个0 bit，使得定界符不会出现在有效载荷中

      ![image-20221002143901340](计网.assets/image-20221002143901340.png)

  - 网络层编码违例：将载荷中不会出现的非法字节标识成定界符

    ![image-20221002143943728](计网.assets/image-20221002143943728.png)

- 差错控制

  - 解决方式：差错检测与纠正、确认重传

- 流量控制

### 差错检测和纠正

- 通常采用增加冗余信息（或称校验信息）的策略

- 两种策略：检测码和纠错码
  - 例子：将每个bit发三份，检测能力是2bit，纠错能力是1bit
  
- 术语
  - ![image-20221002144712014](计网.assets/image-20221002144712014.png)
  
- 海明距离

  - 两个码字之间的海明距离：两个码字之间不同对应比特的数目
  - 一种编码方案的海明距离：任意两个合法码字之间的最小海明距离

- 检错码

  - 奇偶校验：增加一个bit的检验位，可以检验**奇数位**错误
    - 偶校验：保证1的个数为偶数个
    - 海明距离：2
    - 检测能力：1
    - 纠错能力：0

  - 校验和
    - ![image-20221013102545998](计网.assets/image-20221013102545998.png)
  - 循环冗余校验CRC
    - ![image-20221013102748033](计网.assets/image-20221013102748033.png)
    - ![image-20221013102811548](计网.assets/image-20221013102811548.png)
    - 发送方计算方法：将原数D后面加上n个0，然后除以n+1位G，得到n位R，最后传输D+R
    - 接受方计算方法：D+R去除G，如果没有余数就正确
    - ![image-20221013103259252](计网.assets/image-20221013103259252.png)

- 纠错码，这种方法一般叫做FEC，Forward Error Correction

  - ![image-20221013103343755](计网.assets/image-20221013103343755.png)

    这个公式是容易理解的，有效信息完全正确的码字有$2^m$种，错一位的码字有$n\cdot 2^m$中，这两种情况显然一定少于$2^n$种

  - $(m+r+1)\le 2^n$

  - 海明码

    - ![image-20221013104510912](计网.assets/image-20221013104510912.png)

    - ![image-20221013104751418](计网.assets/image-20221013104751418.png)

      第一组：24列

      第二组：34列

      第三组：24行

      第四组：34行

    - 校验方法：用两个校验位可以确定行，两个校验位确定列

      ![image-20221013105049838](计网.assets/image-20221013105049838.png)

    - ![image-20221013105202638](计网.assets/image-20221013105202638.png)

      注意校验位的位置是1,2,4,8...，计数器计算出的值就是错的位置，原理是查表

      ![image-20221013105315951](计网.assets/image-20221013105315951.png)

  - RS Code

  - Convolutional Code 卷积码

    - 例子1

      ![image-20221013105515015](计网.assets/image-20221013105515015.png)

      中间有各种状态，一个bit输入进来就会让两个bit输出

      上面的$\sum$表示对应的bit加起来（其实就是**异或**起来）

      状态会随input变化，一开始所有的state都是0，然后每次**输出**的时候，$S_1$变成input，剩下的向右平移

    - 例子2

      ![image-20221013105931966](计网.assets/image-20221013105931966.png)

      可以提前画一个Trellis diagram

      ![image-20221013111123033](计网.assets/image-20221013111123033.png)

      更好是画一个状态机图

      当有两条路可以走的时候，计算累积海明距离，一边走一边剪枝


### 基本的数据链路层协议

- 定义与假设

  ![image-20221013111528820](计网.assets/image-20221013111528820.png)

- 乌托邦式单工协议

  - ![image-20221013111710078](计网.assets/image-20221013111710078.png)

  - ![image-20221013111742138](计网.assets/image-20221013111742138.png)

    上面的`wait_for_event`永远得到的是`frame_arrival`

- 无错信道单工停止-等待协议

  - ![image-20221013111835267](计网.assets/image-20221013111835267.png)

  - ![image-20221013111908977](计网.assets/image-20221013111908977.png)

  - ![image-20221013111947538](计网.assets/image-20221013111947538.png)

    发送方多了一个`wait_for_event`，并且等待的event就是`frame_arrival`，得到哑帧

- 有错信道单工停止-等待协议

  - ![image-20221013112145565](计网.assets/image-20221013112145565.png)

  - ![image-20221013112227057](计网.assets/image-20221013112227057.png)

    会出现duplicate的情况

  - ![image-20221013112305131](计网.assets/image-20221013112305131.png)

    需要加上sequence，接收方发现有连续的sequence为0的情况，就丢弃重复的帧

  - ![image-20221013112508161](计网.assets/image-20221013112508161.png)

    发送方要确认得到的ACK对应好sequence

  - 效率评估

    ![image-20221013112901587](计网.assets/image-20221013112901587.png)

### 滑动窗口协议

- 停等协议的性能问题

  - ![image-20221013113229690](计网.assets/image-20221013113229690.png)

- 滑动窗口协议

  - ![image-20221013113242853](计网.assets/image-20221013113242853.png)

  - ![image-20221013113305666](计网.assets/image-20221013113305666.png)

  - ![image-20221013113425549](计网.assets/image-20221013113425549.png)

  - 发送方

    ![image-20221013113504956](计网.assets/image-20221013113504956.png)

  - 接收方

    ![image-20221013113557898](计网.assets/image-20221013113557898.png)

- 回退N协议 Protocol 5

  - ![image-20221013114225505](计网.assets/image-20221013114225505.png)

    错误的帧后面都丢弃，接收方累计确认

    适用于接收窗口为1的情况

  - ![image-20221013114547272](计网.assets/image-20221013114547272.png)

  - 如果是接收方没接收到数据，那么后面的就会被discard，然后接受方会一直返回之前的ACK，导致发送方的窗口不移动，最后会timeout

  - 如果是发送方没有接受到ACK，但是因为是累积确认的，后面的ACK会让窗口移动

  - 实现

    ![image-20221013115044223](计网.assets/image-20221013115044223.png)

  - 发送方

    ![image-20221013115056727](计网.assets/image-20221013115056727.png)

    窗口长度有上限，根据sequence number bit来决定

  - 接受方

    ![image-20221013115212382](计网.assets/image-20221013115212382.png)

- 选择重传协议 Protocol 6

  - ![image-20221013115310362](计网.assets/image-20221013115310362.png)
  - 注意：发送窗口应该等于或小于序号空间的**一半**
  - 这里**不是累积确认**，每一个发送都需要一个对应的ACK
  - 如果接收过程中有丢失，效率是不如GBN

### 数据链路层协议实例

- 点到点链路层协议PPP

  - 特点
    - 不可靠传输协议，只进行检错
    - 没有点到点的流量控制
    - 不使用帧的序号
    - 不支持多点线路
    - PPP协议支持全双工链路
  - 构成
    - ![image-20221013141507129](计网.assets/image-20221013141507129.png)
  - 帧的格式
    - ![image-20221013141524542](计网.assets/image-20221013141524542.png)
    - 开头和最后的F是定界符
    - FCS就是CRC的帧检验序列，有检错能力但没有纠错能力
  - 异步传输：Byte stuffing；同步传输：Bit stuffing
  - ![image-20221013142153332](计网.assets/image-20221013142153332.png)

- PPPoE

  - PPP over Ethernet

    - Ethernet优点：原理简单，应用广泛，设备成本低
    - Ethernet缺点：无认证功能
    - PPP优点：提供认证，提供良好的访问控制和计费功能
    - 两者结合

  - 报文：over表示在上层，那么下层的帧就会在payload里包含上面的data

    ![image-20221013142546216](计网.assets/image-20221013142546216.png)

## 第四章 介质访问子层（MAC子层）

### 信道分配问题

广播信道面临的问题：多个站点同时请求占用信道

- 静态信道分配

  - FDM或者TDM

  - 性能分析：信道N等分之后每个信道的平均延迟时间变成N倍（推导略）

    ![image-20221019133308311](计网.assets/image-20221019133308311.png)

    ![image-20221019133421489](计网.assets/image-20221019133421489.png)

- 动态分配

  - 按需分配，多路访问协议

### 多路访问协议

![image-20221019133811994](计网.assets/image-20221019133811994.png)

- 随机访问

  - ALOHA

    - 原理是想发就发，冲突的帧被破坏，一旦破坏就重传
    - ![image-20221019134945563](计网.assets/image-20221019134945563.png)
    - 上图中阴影部分是实际发生的帧，前后两个白帧都会与之产生冲突
    - 在一个帧时里不发送的概率是$P_0=e^{-G}$，而**冲突危险期**是两倍帧时

  - 分槽ALOHA

    - 冲突危险期降低成一个帧时
    - 吞吐量增大成2倍

  - CSMA

    - 特点：先听后发

    - ![image-20221019140126348](计网.assets/image-20221019140126348.png)

    - 非持续CSMA

      - 侦听，如果空闲就发送；否则就等待一个随机时间然后重复上一步。

    - 持续式（1-持续式）CSMA

      - 侦听，如果空闲就发送；如果介质忙，持续侦听，一旦空闲立即发送；如果发生冲突就等待一个随机分布时间再重复步骤一

    - p-持续式CSMA

      - 上面步骤一改成：如果空闲，就以p的概率发送，以(1-p)的概率延迟一个时间单元发送

    - 先听再发也会发生冲突

      - 同时传送

      - 传播延迟时间

        ![image-20221019140938004](计网.assets/image-20221019140938004.png)

        定义冲突窗口：发送站发出帧后能检测到冲突（碰撞）的最长时间

        数值上：等于最远两站**传播时间的两倍**，等于RTT（Round Trip Time）

    - CSMA/CD

      - 原理：先听后发、边发边听
      - ![image-20221019141429903](计网.assets/image-20221019141429903.png)
      - 发送帧的时间**不能太短**，至少一个冲突窗口的时间，所以发送的帧的长度稍长

    - ![image-20221019142046240](计网.assets/image-20221019142046240.png)

      p越小，越适用于高负载的情况，但是延迟会高

- 受控访问

  - 位图协议 Bitmap

    - ![image-20221019142340327](计网.assets/image-20221019142340327.png)

    - 性能

      ![image-20221019142650815](计网.assets/image-20221019142650815.png)

    - 待补充

- 有限竞争

  - 自适应树搜索协议
    - ![image-20221019144025826](计网.assets/image-20221019144025826.png)
    - 结合前两种方法，每次竞争的时候竞争范围在缩小

### 以太网

- 经典以太网

  - 最高10Mbps

  - 曼彻斯特编码

  - MAC子层协议：CSMA/CD协议

  - 数据46byte到1500byte：太少CD协议失效且数据利用率低，太长错误bit过多。如果不够46byte需要补0

    ![image-20221019151257796](计网.assets/image-20221019151257796.png)

  - 注意：Physical Address是MAC地址，属于**数据链路层**，前三个字节属于一个组织

  - 校验和

    ![image-20221019151320761](计网.assets/image-20221019151320761.png)

  - ![image-20221019151404063](计网.assets/image-20221019151404063.png)

  - 问题：冲突域非常大，使用同一个channel

- 交换式以太网

  - 核心是交换机
  - ![image-20221019152338298](计网.assets/image-20221019152338298.png)

### 数据链路层交换

- 数据链路层交换原理

  - ![image-20221019153124715](计网.assets/image-20221019153124715.png)
  - 在冲突域中是广播信道，需要使用多路访问协议
  - 网桥是透明，即插即用的
  - ![image-20221019153538585](计网.assets/image-20221019153538585.png)
  - 当A发送给B的时候，信息也达到bridge，然后MAC地址表中就增加一条A对应的端口是1
  - MAC地址表可能会溢出，有类似攻击
  - 如果在MAC地址中找不到就Flooding泛洪，向所有的端口都发送（如果目的地址为FF-FF-FF-FF-FF-FF的数据帧也要Flooding）

- 链路层交换机

  - ![image-20221019155007425](计网.assets/image-20221019155007425.png)

    都不冲突

  - 交换方式

    - 对称交换：出和入的带宽相同
    - 非对称交换：出和入的带宽不同

  - 交换模式

    - 存储转发模式
      - 转发必须接受整个帧并执行CRC校验
      - 缺点：延迟大
      - 优点：不转发出错帧、支持非对称交换
    - 直通模式
      - 接收到目的地址就开始转发
      - 缺点：可能转发错误帧，不支持非对称交换
      - 优点：延迟非常小，可以边入边出
    - 无碎片模式
      - 接受帧的前64个byte就开始转发（为什么是64byte，因为CSMA/CD中要求帧最小不能小于64）
      - 缺点：可能转发错误帧
      - 优点：过滤了冲突碎片，延迟介于上面两者之间

- 生成树协议 STP

  - 可靠传输：冗余拓扑
  - 付出的代价：导致物理环路
  - 物理环路的问题
    - 广播风暴
    - 重复帧
    - MAC地址不稳定

  - 如何得到无环的生成树
    - 参与的交换机（网桥）：收发桥协议数据单元BPDU
    - 选举产生根桥、根端口、指定端口、形成生成树
    - ![image-20221029105336150](计网.assets/image-20221029105336150.png)
    - ![image-20221029105347719](计网.assets/image-20221029105347719.png)
    - ![image-20221029105417444](计网.assets/image-20221029105417444.png)
    - ![image-20221029105511665](计网.assets/image-20221029105511665.png)
    - ![image-20221029105704852](计网.assets/image-20221029105704852.png)
    - ![image-20221029105825438](计网.assets/image-20221029105825438.png)
    - ![image-20221029110108660](计网.assets/image-20221029110108660.png)
    - ![image-20221029110119161](计网.assets/image-20221029110119161.png)
    - ![image-20221029110150589](计网.assets/image-20221029110150589.png)
    - （T）根桥的所有端口都是指定端口

- 虚拟局域网

  - 广播域：广播帧能够达到的所有范围

  - 缺省状态下，交换机所有端口同属一个广播域，无法隔离广播域，具有安全隐患

  - 交换机利用VLAN来隔离

  - VLAN类型

    - 基于端口的VLAN
    - 基于MAC地址的VLAN
    - 基于协议的VLAN
    - 基于子网的VLAN

  - 基于端口的VLAN

    - ![image-20221029110756442](计网.assets/image-20221029110756442-16670128785971.png)

  - ![image-20221029110907003](计网.assets/image-20221029110907003.png)

    VLAN个数最多支持4096

  - ![image-20221029111037218](计网.assets/image-20221029111037218.png)

  - ![image-20221029111106616](计网.assets/image-20221029111106616.png)

  - 连接终端的称为Access端口，连接不同交换机的称为Trunk端口


### 无线局域网

- 设计目标
  - 使用无需授权的频谱（ISM频段）
- 组网模式
  - ![image-20221029112022295](计网.assets/image-20221029112022295.png)
  - ![image-20221029113105432](计网.assets/image-20221029113105432.png)
- ![image-20221029113140939](计网.assets/image-20221029113140939.png)
- ![image-20221029113246640](计网.assets/image-20221029113246640.png)
- 介质访问两大问题
  - 隐藏终端问题
    - ![image-20221029113554655](计网.assets/image-20221029113554655.png)
    - 导致网络冲突
  - 暴露终端问题
    - ![image-20221029113647834](计网.assets/image-20221029113647834.png)
    - 导致效率降低
  - 这两个问题不能完美解决
- CSMA / CA
  - ![image-20221029113811921](计网.assets/image-20221029113811921.png)
  - ![image-20221029113928123](计网.assets/image-20221029113928123.png)
  - 无视了隐藏终端问题
- 差错检测和确认重传
  - 差错检测：32位CRC校验
  - 采用停等机制：发送数据，等待确认，超时重传（不采用流水线）
    - 访问延迟小，RTT很小，所以直接用停等协议即可
  - 如果达到最大重传限制，该帧就被丢弃，并告知上层协议

- 不同帧间隙控制优先级
  - ![image-20221029114303529](计网.assets/image-20221029114303529.png)
- RTS-CTS机制
  - ![image-20221029114532715](计网.assets/image-20221029114532715.png)
- 无限链路较高的出错率
  - 采用较小的帧
  - $F_i$帧中携带$F_{i+1}$的传输时间
- ![image-20221029115121533](计网.assets/image-20221029115121533.png)
- 无限局域网基础架构模式
  - ![image-20221029115228937](计网.assets/image-20221029115228937.png)
  - 扫描
    - 被动扫描：AP周期性发送Beacon帧，站点在每个可用的通道上扫描Beacon帧
    - 主动扫描

## 第五章 网络层

### 网络层服务

- 网络层连接的是两个主机
- 采取无连接协议

### 网际协议

- IPv4协议
  - 数据报分片
    - MTU（Maximum Transmission Unit）最大传输单元

    - 重组策略：互联网使用的目的端重组

    - ![image-20221120235645334](计网.assets/image-20221120235645334.png)

      `DF`标志表示是否允许分片，`MF`（more fragment）标志表示是否为分片的末尾，偏移位的单位是8字节，所以要除以8

    - ![image-20221121000434262](计网.assets/image-20221121000434262.png)

    - ![image-20221121000631479](计网.assets/image-20221121000631479.png)

      当分配地址的时候，如果分配X个地址，那么要么从0开始分配X个要么从X开始分配X个。

  - DHCP

    - ![image-20221121004250588](计网.assets/image-20221121004250588.png)
    - ![image-20221121004343063](计网.assets/image-20221121004343063.png)

  - ARP

    - ![image-20221121004616713](计网.assets/image-20221121004616713.png)

    - 跨网：先在一个局域网中用ARP发送到路由器然后转发到另一个网络

      ![image-20221121004930436](计网.assets/image-20221121004930436.png)

  - 网络地址转换

    - ![image-20221121005136219](计网.assets/image-20221121005136219.png)

    - ![image-20221121005411694](计网.assets/image-20221121005411694.png)

      边界路由器加上端口号

  - ICMP

    - 用ping得到TTL

### 路由算法

- 最短路径算法

  - Dijkstra算法

- 路由算法

  - 距离向量路由 Bellman-Ford方程

    ![image-20221121102923191](计网.assets/image-20221121102923191.png)

    ![image-20221121103056127](计网.assets/image-20221121103056127.png)

    缺陷：好消息传播快，但坏消息很难传播 count-to-infinity

    ![image-20221121103854356](计网.assets/image-20221121103854356.png)

    毒性逆转，如果有环就发生错误。

    ![image-20221121103904940](计网.assets/image-20221121103904940.png)

  - 链路状态路由

    - ![image-20221121104306154](计网.assets/image-20221121104306154.png)
    - ![image-20221121104510922](计网.assets/image-20221121104510922.png)

  - 层次路由

    - ![image-20221121105215819](计网.assets/image-20221121105215819.png)
    - ![image-20221121105230490](计网.assets/image-20221121105230490.png)
    - ![image-20221121105317514](计网.assets/image-20221121105317514.png)
    - ![image-20221121105420498](计网.assets/image-20221121105420498.png)

  - 广播路由

    - Flooding

      ![image-20221121110205415](计网.assets/image-20221121110205415.png)

    - ![image-20221121110235179](计网.assets/image-20221121110235179.png)

    - ![image-20221121110245525](计网.assets/image-20221121110245525.png)

    - ![image-20221121110445001](计网.assets/image-20221121110445001.png)

      当得到一个数据包的时候，判断这个数据包的来源S和接口X，如果是从本路由器到S的最佳路径就是从X走的，那么就接受否则就不接受。相当于只接受最初的一份。

    - ![image-20221121114638039](计网.assets/image-20221121114638039.png)

    - ![image-20221121114648244](计网.assets/image-20221121114648244.png)

    - ![image-20221121114715893](计网.assets/image-20221121114715893.png)

### Internet路由协议

略

### 路由器工作原理

![image-20221121120432524](计网.assets/image-20221121120432524.png)

![image-20221121120447646](计网.assets/image-20221121120447646.png)

### IPv6技术

![image-20221121121504485](计网.assets/image-20221121121504485.png)

## 第六章 传输层

### 概述和传输层服务

![image-20221121122428706](计网.assets/image-20221121122428706.png)

### 传输层复用和分用

![image-20221121144821738](计网.assets/image-20221121144821738.png)

### 无连接传输：UDP

![image-20221121145136531](计网.assets/image-20221121145136531.png)

### 面向连接传输：TCP

![image-20221121150013128](计网.assets/image-20221121150013128.png)

![image-20221121171510372](计网.assets/image-20221121171510372.png)

![image-20221121171522240](计网.assets/image-20221121171522240.png)

![image-20221121171652894](计网.assets/image-20221121171652894.png)

![image-20221121171752991](计网.assets/image-20221121171752991.png)

![image-20221121172058438](计网.assets/image-20221121172058438.png)

![image-20221121172107233](计网.assets/image-20221121172107233.png)

![image-20221121172116189](计网.assets/image-20221121172116189.png)

![image-20221121173336350](计网.assets/image-20221121173336350.png)

![image-20221121173615663](计网.assets/image-20221121173615663.png)

为了避免sequence number循环出现的问题：

- 限制包的Life Time

- 用一个时钟来记录

  ![image-20221201005153158](计网.assets/image-20221201005153158.png)

  下面是一个例子：如果$T$是70s（两个相同sequence number被区分开的间隔时间）。如果$x$时间开始，那么sequence number就设置成从$x$开始增加，下面的例子是如果30s的时候发了一个80,85秒的时候又发个80，就不能区分开来。所以不能在forbidden region里面。

  ![image-20221201090117371](计网.assets/image-20221201090117371.png)

  ![image-20221201090735421](计网.assets/image-20221201090735421.png)

三次握手：

![image-20221201091255009](计网.assets/image-20221201091255009.png)

![image-20221201091749193](计网.assets/image-20221201091749193.png)

![image-20221201091757162](计网.assets/image-20221201091757162.png)

![image-20221201092623558](计网.assets/image-20221201092623558.png)

存在two army problem，实际设计中还是需要引入timeout机制

![image-20221201092703657](计网.assets/image-20221201092703657.png)

![image-20221201092915389](计网.assets/image-20221201092915389.png)

![image-20221201093040284](计网.assets/image-20221201093040284.png)

### TCP拥塞控制

![image-20221201093638230](计网.assets/image-20221201093638230.png)

### 拥塞控制的发展

![image-20221201100713597](计网.assets/image-20221201100713597.png)

wireless无线丢包发生在不同的timescale（远小于TCP时间）所以不会影响网络

![image-20221201102241975](计网.assets/image-20221201102241975.png)

![image-20221201102755037](计网.assets/image-20221201102755037.png)

不使用RTT直接使用时钟：

![image-20221201102904161](计网.assets/image-20221201102904161.png)

以上都是被动机制

![image-20221201103107455](计网.assets/image-20221201103107455.png)

## 第七章 应用层

### 应用层概述

- 服务器进程工作方式
  - 循环方式（主要是面向无连接）
    - ![image-20221209161113392](计网.assets/image-20221209161113392.png)
  - 并发方式（主要是面向连接）
    - ![image-20221209161123889](计网.assets/image-20221209161123889.png)

### 域名系统

![image-20221209163357178](计网.assets/image-20221209163357178.png)

![image-20221209163545625](计网.assets/image-20221209163545625.png)

anycast：DNS服务器有相同的IP地址但是服务器不同，但是我不在意是哪个服务器给我的反馈

![image-20221209163815813](计网.assets/image-20221209163815813.png)

### 电子邮件

![image-20221209165524416](计网.assets/image-20221209165524416.png)

![image-20221209170457345](计网.assets/image-20221209170457345.png)

## 第八章 网络安全

### 网络攻击与威胁

- 攻击类型

  - 被动式
    - 窃听
    - 嗅探
  - 主动式
    - 网络欺骗
    - 干扰与瘫痪

- ARP攻击

  - 对路由器ARP表的欺骗

  - 对局域网内PC的网关欺骗

  - 毒化

    ![image-20221209211701066](计网.assets/image-20221209211701066.png)

    ![image-20221209211711914](计网.assets/image-20221209211711914.png)

    ![image-20221209211818323](计网.assets/image-20221209211818323.png)

- Deny of Service

  - ![image-20221209211901638](计网.assets/image-20221209211901638.png)

- SYN Floods

  - ![image-20221216104221488](计网.assets/image-20221216104221488.png)
  - 解决方案：避免保持连接状态
  - ![image-20221216104320823](计网.assets/image-20221216104320823.png)

- 放大攻击

  - ![image-20221216104458985](计网.assets/image-20221216104458985.png)

- MAC Flooding

  - ![image-20221216104746261](计网.assets/image-20221216104746261.png)

- 物联网设备作为僵尸机器

  - ![image-20221216105117493](计网.assets/image-20221216105117493.png)

- APT攻击

  - ![image-20221216105243568](计网.assets/image-20221216105243568.png)


### 安全机制与手段

- 密码学

  - ![image-20221216105739354](计网.assets/image-20221216105739354.png)

  - 攻击者能力类型

    - 唯密文
    - 已知明文
    - 选择明文

  - 古典密码学

    - 凯撒密码 Substituion Ciphers
    - Transposition Ciphers
    - One-time pads，缺点是pad和数据一样长

  - 现代加密算法

    - 对称密码算法

      ![image-20221216112147607](计网.assets/image-20221216112147607.png)

      - Feistel结构
        - ![image-20221216111538507](计网.assets/image-20221216111538507.png)
      - DES算法
        - ![image-20221216111712764](计网.assets/image-20221216111712764.png)
      - 3DES
      - IDEA
      - AES
        - ![image-20221216111851096](计网.assets/image-20221216111851096.png)

    - 非对称密码算法

      - ![image-20221216112333992](计网.assets/image-20221216112333992.png)

      - RSA

        - ![image-20221216112400019](计网.assets/image-20221216112400019.png)

          ![image-20221216112432943](计网.assets/image-20221216112432943.png)

          ![image-20221216112550868](计网.assets/image-20221216112550868.png)

      - 椭圆曲线密码ECC

      - 非对称密钥加密内容非常慢，所以可以用来做对称密钥分配

        ![image-20221216113445409](计网.assets/image-20221216113445409.png)

        ![image-20221216113540318](计网.assets/image-20221216113540318.png)

        ![image-20221216113651633](计网.assets/image-20221216113651633.png)

- 数字签名与报文完整性

  - ![image-20221216113709131](计网.assets/image-20221216113709131.png)
  
  - ![image-20221216114138446](计网.assets/image-20221216114138446.png)
  
  - ![image-20230105003000609](计网.assets/image-20230105003000609.png)
    1. 给P加密两次，分别是用A的私钥和B的公钥
    2. 给P加密一次，用A的私钥作为签名
    3. 先对P做摘要然后再用A的私钥加密（最快）
  
  - 生日悖论：对于$m$bit长度，找一个collision往往只需要$2^{m/2}$次
  
  - 要确保Bob拿到Alice正确的公钥，这里就对公钥进行加密，称为证书
  
    ![image-20230105092249067](计网.assets/image-20230105092249067.png)
  
    CA对用户公钥进行加密，而CA公钥是预装的（比如在浏览器中）
  
    ![image-20230105092401634](计网.assets/image-20230105092401634.png)
  
    可以层层认证，像DNS一样保存Root CA然后再去找下面的CA
  
    ![image-20230105092605624](计网.assets/image-20230105092605624.png)
  
  - 认证协议：两方共有一个私钥，要验证是双方
  
    challenge-response protocol：Bob给Alice一个随机数$R_B$，让对方用共有的私钥加密，加密完之后返回给Bob，Bob验证；然后双方交换。不完全。
  
    ![image-20230105093127730](计网.assets/image-20230105093127730.png)
  
    Trudy先发A给Bob表示自己是Alice然后发送一个随机数问题$R_T$，然后Bob用$K_{AB}$加密$R_T$，并给Trudy一个题目$R_B$，Trudy直接新起一个session然后问Bob，$R_B$的答案（reflection attack）
  
    ![image-20230105093439401](计网.assets/image-20230105093439401.png)

### 电子邮件安全

- 保密性

  Alice：

  - 随机生成对称私钥$K_s$
  - 用私钥$K_s$加密信息$m$，运算$K_s(m)$
  - 用Bob的公钥加密私钥$K_s$，运算$K_B^+(K_s)$
  - 发送$K_s(m)$和$K_B^+(K_s)$

  Bob：

  - 使用Bob私钥解密得到Alice的私钥$K_s$
  - 使用私钥解密$m$

- 完整性

  Alice先对消息进行hash，然后用私钥$K_A^-$加密$H(m)$

  ![image-20230105094149443](计网.assets/image-20230105094149443.png)

- 保密性和完整性

  ![image-20230105094315103](计网.assets/image-20230105094315103.png)

  Alice发送三个东西，签名、对称私钥加密的m、用Bob公钥加密的对称私钥

- 保密协议PGP

- ![image-20230105094629357](计网.assets/image-20230105094629357.png)

### Web安全

- SQL注入

- XSS 跨站脚本攻击：用户点进一个钓鱼网站，然后evil.com会发送一段脚本给用户执行，用户转去发送给naive.com就会伪造成善良用户的访问

  ![image-20230105095207916](计网.assets/image-20230105095207916.png)

- 点击劫持

- 挂马攻击

  ![image-20230105095415374](计网.assets/image-20230105095415374.png)

### 通信安全

- 传输层安全

  ![image-20230105095501435](计网.assets/image-20230105095501435.png)

  - SSL目前被废弃
  - TLS：web服务器https端口443（普通的是80）
  - HTTPS：HTTP+TLS/SSL

- 网络层安全

  ![image-20230105095850879](计网.assets/image-20230105095850879.png)

  IP安全数据报有两种模式：传输模式和隧道模式（用来实现VPN）

  ![image-20230105095936697](计网.assets/image-20230105095936697.png)

  ![image-20230105095946074](计网.assets/image-20230105095946074.png)

  安全关联（SA），为了实现完全性，IP无连接性变成有连接。IP面向无连接，IP Sec面向连接

- 无线网络安全：WPA3

### 安全技术前沿与未来发展

- BB84协议（量子密钥分发）
  - ![image-20230105101300036](计网.assets/image-20230105101300036.png)
  - ![image-20230105101313209](计网.assets/image-20230105101313209.png)
  - ![image-20230105101357589](计网.assets/image-20230105101357589.png)
  - ![image-20230105101516263](计网.assets/image-20230105101516263.png)

## 新型网络及网络新技术

- 物联网：NBIOT、LoRa

  ![image-20230105102847478](计网.assets/image-20230105102847478.png)
